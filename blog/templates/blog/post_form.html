{% extends 'base.html' %}

{% block title %}Compartir experiencia - Blog SIESE{% endblock %}

{% block content %}
<section class="py-16 bg-gray-50">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="bg-white rounded-3xl shadow-xl border border-gray-100 p-8 md:p-10 space-y-8">
            <div>
                <span class="inline-flex items-center px-4 py-2 bg-solar-yellow bg-opacity-20 rounded-full text-colombia-blue font-semibold text-sm">
                    <i class="fas fa-pen mr-2"></i>
                    Nueva publicación
                </span>
                <h1 class="mt-4 text-3xl font-bold text-colombia-blue">Cuéntale al mundo tu historia en energías renovables</h1>
                <p class="text-gray-600 mt-2">Escribe libremente como si fuera un hilo. Puedes mencionar fechas, lugares, aprendizajes y compartir hasta 5 fotos para darle vida a tu relato.</p>
            </div>

            {% if form.non_field_errors %}
            <div class="rounded-lg border border-red-300 bg-red-50 text-red-700 px-4 py-3">
                {% for error in form.non_field_errors %}
                    <p>{{ error }}</p>
                {% endfor %}
            </div>
            {% endif %}

            <form method="post" enctype="multipart/form-data" class="space-y-6">
                {% csrf_token %}
                {{ form.category }}
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Título</label>
                    {{ form.title }}
                    {% for error in form.title.errors %}
                    <p class="mt-1 text-sm text-red-600">{{ error }}</p>
                    {% endfor %}
                </div>

                <div class="bg-gray-50 rounded-2xl border border-dashed border-gray-300 p-4 text-sm text-gray-500">
                    <i class="fas fa-lightbulb mr-2 text-solar-yellow"></i>
                    Comparte hitos, aprendizajes, retos, o cómo cambió tu comunidad. Entre más auténtico, mejor.
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Tu historia</label>
                    {{ form.content }}
                    {% for error in form.content.errors %}
                    <p class="mt-1 text-sm text-red-600">{{ error }}</p>
                    {% endfor %}
                    <p class="mt-1 text-xs text-gray-400">Puedes escribir en el formato que prefieras, mencionar fechas, lugares, enlaces o citar fuentes dentro del texto.</p>
                </div>

                <div>
                    <h2 class="text-lg font-semibold text-colombia-blue mb-3">Galería de imágenes</h2>
                    <p class="text-sm text-gray-500 mb-4">Sube hasta 5 fotos (JPG o PNG). Puedes dejar este apartado vacío.</p>
                    {{ image_formset.management_form }}
                    <div class="grid gap-4">
                        {% for formset_form in image_formset %}
                        <div class="p-4 border border-gray-200 rounded-xl bg-gray-50 space-y-3">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Imagen {{ forloop.counter }}</label>
                                {{ formset_form.image }}
                                {% for error in formset_form.image.errors %}
                                <p class="mt-1 text-sm text-red-600">{{ error }}</p>
                                {% endfor %}
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">Descripción</label>
                                {{ formset_form.caption }}
                                {% for error in formset_form.caption.errors %}
                                <p class="mt-1 text-sm text-red-600">{{ error }}</p>
                                {% endfor %}
                            </div>
                            {% if formset_form.instance.pk %}
                            <div class="flex items-center">
                                {{ formset_form.DELETE }}
                                <label class="ml-2 text-sm text-gray-600">Eliminar imagen</label>
                            </div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <div class="flex items-center justify-end gap-3">
                    <a href="{% url 'blog:home' %}" class="px-5 py-3 rounded-lg border border-gray-300 text-gray-600 hover:border-solar-yellow transition">Cancelar</a>
                    <button type="submit" class="px-6 py-3 rounded-lg bg-colombia-blue text-white font-semibold hover:bg-blue-800 transition">
                        Publicar experiencia
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>
{% endblock %}
