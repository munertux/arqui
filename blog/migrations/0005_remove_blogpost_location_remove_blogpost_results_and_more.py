# Generated by Django 5.0.6 on 2025-10-17 19:49

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('blog', '0004_blogreport_processed_at_blogreport_processed_by_and_more'),
    ]

    def combine_content(apps, schema_editor):
        BlogPost = apps.get_model('blog', 'BlogPost')
        for post in BlogPost.objects.all():
            parts = []
            summary = getattr(post, 'summary', '') or ''
            results = getattr(post, 'results', '') or ''
            sources = getattr(post, 'sources', '') or ''
            if summary:
                parts.append(summary)
            if results:
                parts.append('Resultados y aprendizajes:\n' + results)
            if sources:
                parts.append('Fuentes y referencias:\n' + sources)
            combined = '\n\n'.join(parts).strip()
            post.content = combined
            post.save(update_fields=['content'])

    def split_content(apps, schema_editor):
        BlogPost = apps.get_model('blog', 'BlogPost')
        for post in BlogPost.objects.all():
            text = post.content or ''
            setattr(post, 'summary', text)
            setattr(post, 'results', '')
            setattr(post, 'sources', '')
            setattr(post, 'year', 0)
            setattr(post, 'location', '')
            post.save(update_fields=['summary', 'results', 'sources', 'year', 'location'])

    operations = [
        migrations.AddField(
            model_name='blogpost',
            name='content',
            field=models.TextField(default='', verbose_name='Contenido del caso'),
        ),
        migrations.RunPython(combine_content, reverse_code=split_content),
        migrations.RemoveField(
            model_name='blogpost',
            name='location',
        ),
        migrations.RemoveField(
            model_name='blogpost',
            name='results',
        ),
        migrations.RemoveField(
            model_name='blogpost',
            name='sources',
        ),
        migrations.RemoveField(
            model_name='blogpost',
            name='summary',
        ),
        migrations.RemoveField(
            model_name='blogpost',
            name='year',
        ),
    ]
